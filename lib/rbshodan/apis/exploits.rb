require_relative 'utils.rb'

module Rbshodan
    module API

        class Exploits
            include Rbshodan::API::Utils

            attr_accessor :key

            URL = 'https://exploits.shodan.io'

            def initialize(key: ENV['SHODAN_API_KEY'])
                @url    = URL
                @client = Async::HTTP::Client.new(Async::HTTP::Endpoint.parse(@url))
                self.key = key

                warn 'No key been found or provided!' unless key?
            end

            def key?
                return true if @key

                false 
            end

            def search(query = '', facts: {}, page: 1, **params)
                params[:query] = query
                params = turn_into_query(**params)
                facets = turn_into_facets(**facets)
                params[:page] = page
                get('api/search', **params.merge(**facets))
            end
            