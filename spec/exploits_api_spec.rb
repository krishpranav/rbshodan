require "spec_helper"

RSpec.describe Shodanz::API::Exploits do
  before do
    @client = Shodanz.api.exploits.new
  end

  before(:each) do

    sleep 3
  end

  describe '#search' do
    def check
      if Async::Task.current?
        resp = @client.search("SQL", port: 443).wait
      else
        resp = @client.search("SQL", port: 443)
      end
      expect(resp).to be_a(Hash)
    end

    describe 'search across a variety of data sources for exploits' do
      it 'works synchronously' do
        check
      end

      it 'works asynchronously' do
        Async do
          check
        end
      end
    end
  end
end
